@page
@namespace Tail.Blazor.Docs.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "_Layout";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tail.Blazor Documentation</title>
    <base href="~/" />
    
    <!-- Tailwind CSS with dark mode config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable class-based dark mode
            theme: {
                extend: {}
            }
        }
    </script>
    
    <!-- Theme initialization - Load and apply theme BEFORE page renders -->
    <script>
        (function() {
            try {
                // Load theme settings from localStorage
                const themeSettingsJson = localStorage.getItem('tail-blazor-theme-settings');
                const legacyTheme = localStorage.getItem('tail-blazor-theme');
                
                let isDark = false;
                let colors = null;
                
                if (themeSettingsJson) {
                    // New theme system
                    const settings = JSON.parse(themeSettingsJson);
                    isDark = settings.Mode === 'Dark';
                    colors = settings.Colors;
                } else if (legacyTheme) {
                    // Legacy theme toggle
                    isDark = legacyTheme === 'Dark';
                }
                
                // Apply dark mode class
                if (isDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    // Check system preference if no saved theme
                    if (!themeSettingsJson && !legacyTheme && 
                        window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.documentElement.classList.add('dark');
                    }
                }
                
                // Apply theme colors as CSS variables
                if (colors) {
                    const root = document.documentElement;
                    // Primary Colors
                    root.style.setProperty('--color-primary', colors.Primary || '#3b82f6');
                    root.style.setProperty('--color-secondary', colors.Secondary || '#8b5cf6');
                    root.style.setProperty('--color-accent', colors.Accent || '#ec4899');
                    // State Colors
                    root.style.setProperty('--color-success', colors.Success || '#10b981');
                    root.style.setProperty('--color-warning', colors.Warning || '#f59e0b');
                    root.style.setProperty('--color-danger', colors.Danger || '#ef4444');
                    root.style.setProperty('--color-info', colors.Info || '#3b82f6');
                    // Background & Surfaces
                    root.style.setProperty('--color-background', colors.Background || '#ffffff');
                    root.style.setProperty('--color-surface', colors.Surface || '#f9fafb');
                    root.style.setProperty('--color-surface-2', colors.Surface2 || '#f3f4f6');
                    root.style.setProperty('--color-surface-3', colors.Surface3 || '#e5e7eb');
                    // Text Colors
                    root.style.setProperty('--color-text-primary', colors.TextPrimary || '#111827');
                    root.style.setProperty('--color-text-secondary', colors.TextSecondary || '#6b7280');
                    root.style.setProperty('--color-text-muted', colors.TextMuted || '#9ca3af');
                    // Borders & Dividers
                    root.style.setProperty('--color-border', colors.Border || '#e5e7eb');
                    root.style.setProperty('--color-divider', colors.Divider || '#d1d5db');
                    // Shadows
                    root.style.setProperty('--shadow-sm', colors.ShadowSm || '0 1px 2px 0 rgba(0, 0, 0, 0.05)');
                    root.style.setProperty('--shadow-md', colors.ShadowMd || '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)');
                    root.style.setProperty('--shadow-lg', colors.ShadowLg || '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)');
                    // Border Radius
                    root.style.setProperty('--radius-sm', colors.RadiusSm || '0.25rem');
                    root.style.setProperty('--radius-md', colors.RadiusMd || '0.5rem');
                    root.style.setProperty('--radius-lg', colors.RadiusLg || '0.75rem');
                    // Transitions
                    root.style.setProperty('--transition-fast', colors.TransitionFast || '150ms');
                    root.style.setProperty('--transition-normal', colors.TransitionNormal || '300ms');
                    
                    console.log('Theme applied:', settings.PresetName, settings.Mode);
                }
            } catch (e) {
                console.error('Error loading theme:', e);
            }
        })();
    </script>
    
    <link href="css/app.css" rel="stylesheet" />
    <link href="Tail.Blazor.Docs.styles.css" rel="stylesheet" />
    <component type="typeof(Microsoft.AspNetCore.Components.Web.HeadOutlet)" render-mode="ServerPrerendered" />
</head>
<body>
    <component type="typeof(App)" render-mode="ServerPrerendered" />

    <div id="blazor-error-ui">
        <environment include="Staging,Production">
            An error has occurred. This application may no longer respond until reloaded.
        </environment>
        <environment include="Development">
            An unhandled exception has occurred. See browser dev tools for details.
        </environment>
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.server.js"></script>
</body>
</html>
