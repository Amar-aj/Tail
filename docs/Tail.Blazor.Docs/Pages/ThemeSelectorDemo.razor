@page "/theme-selector-demo"
@using Tail.Blazor.Core.Theme
@using Tail.Blazor.Buttons
@inject ThemeService ThemeService
@implements IDisposable

<PageTitle>Theme Selector - Tail.Blazor</PageTitle>

<div class="container mx-auto px-4 py-8 max-w-7xl">
    <h1 class="text-4xl font-bold mb-2 text-gray-900 dark:text-white">Theme Selector</h1>
    <p class="text-lg text-gray-600 dark:text-gray-400 mb-8">
        Choose from 5 predefined themes or create your own custom theme. All settings are saved to localStorage.
    </p>

    <div class="grid lg:grid-cols-2 gap-8">
        <!-- Theme Selector -->
        <div>
            <TailThemeControl ShowThemeSelector="true" ShowModeToggle="true" />
        </div>

        <!-- Theme Preview -->
        <div>
            <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Component Preview</h2>
            <div class="space-y-6">
                <!-- Buttons -->
                <div class="p-6 rounded-lg theme-card border">
                    <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Buttons</h3>
                    <div class="flex flex-wrap gap-3">
                        <TailButton Variant="ButtonVariant.Primary">Primary</TailButton>
                        <TailButton Variant="ButtonVariant.Success">Success</TailButton>
                        <TailButton Variant="ButtonVariant.Warning">Warning</TailButton>
                        <TailButton Variant="ButtonVariant.Danger">Danger</TailButton>
                        <TailButton Variant="ButtonVariant.Info">Info</TailButton>
                    </div>
                </div>

                <!-- Cards -->
                <div class="p-6 rounded-lg theme-card border">
                    <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Card Example</h3>
                    <div class="p-4 rounded-lg theme-card border">
                        <h4 class="font-bold text-gray-900 dark:text-white mb-2">Card Title</h4>
                        <p class="text-gray-600 dark:text-gray-400 mb-3">
                            This is a sample card demonstrating how the theme colors are applied to different components.
                        </p>
                        <button class="theme-button px-4 py-2 rounded-lg">
                            Action Button
                        </button>
                    </div>
                </div>

                <!-- Form Elements -->
                <div class="p-6 rounded-lg theme-card border">
                    <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Form Elements</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Text Input</label>
                            <input type="text" placeholder="Enter text..." 
                                   class="theme-input w-full px-3 py-2 border rounded-lg focus:ring-2" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Select</label>
                            <select class="theme-input w-full px-3 py-2 border rounded-lg">
                                <option>Option 1</option>
                                <option>Option 2</option>
                                <option>Option 3</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="check1" class="rounded" />
                            <label for="check1" class="text-sm text-gray-700 dark:text-gray-300">Checkbox Option</label>
                        </div>
                    </div>
                </div>

                <!-- Alerts -->
                <div class="p-6 rounded-lg theme-card border">
                    <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Alerts</h3>
                    <div class="space-y-2">
                        <div class="p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800">
                            <strong>Info:</strong> This is an info message
                        </div>
                        <div class="p-3 rounded-lg bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border border-green-200 dark:border-green-800">
                            <strong>Success:</strong> Operation completed successfully
                        </div>
                        <div class="p-3 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300 border border-yellow-200 dark:border-yellow-800">
                            <strong>Warning:</strong> Please review your input
                        </div>
                        <div class="p-3 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800">
                            <strong>Error:</strong> An error occurred
                        </div>
                    </div>
                </div>

                <!-- Typography -->
                <div class="p-6 rounded-lg theme-card border">
                    <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Typography</h3>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Heading 1</h1>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Heading 2</h2>
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Heading 3</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-2">
                        This is regular paragraph text demonstrating the theme's text colors and readability.
                    </p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        This is secondary text often used for descriptions and helper text.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Current Theme Info -->
    <div class="mt-8 p-6 rounded-lg theme-card border">
        <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Current Theme Settings</h2>
        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Theme Information</h3>
                <dl class="space-y-1 text-sm">
                    <div class="flex justify-between">
                        <dt class="text-gray-600 dark:text-gray-400">Preset:</dt>
                        <dd class="font-medium text-gray-900 dark:text-white">@currentSettings.PresetName</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600 dark:text-gray-400">Mode:</dt>
                        <dd class="font-medium text-gray-900 dark:text-white">@currentSettings.Mode</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-600 dark:text-gray-400">Custom:</dt>
                        <dd class="font-medium text-gray-900 dark:text-white">@(currentSettings.IsCustom ? "Yes" : "No")</dd>
                    </div>
                </dl>
            </div>
            <div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Color Palette</h3>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <div class="w-full h-12 rounded mb-1" style="background-color: @currentSettings.Colors.Primary"></div>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Primary</p>
                    </div>
                    <div>
                        <div class="w-full h-12 rounded mb-1" style="background-color: @currentSettings.Colors.Secondary"></div>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Secondary</p>
                    </div>
                    <div>
                        <div class="w-full h-12 rounded mb-1" style="background-color: @currentSettings.Colors.Accent"></div>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Accent</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Features -->
    <div class="mt-8">
        <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Features</h2>
        <div class="grid md:grid-cols-3 gap-4">
            <div class="p-4 rounded-lg theme-card border">
                <div class="text-3xl mb-2">??</div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-1">5 Preset Themes</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">Ocean, Forest, Sunset, Purple Haze, and Midnight themes</p>
            </div>
            <div class="p-4 rounded-lg theme-card border">
                <div class="text-3xl mb-2">??</div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Dark & Light Mode</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">Each theme has optimized light and dark variants</p>
            </div>
            <div class="p-4 rounded-lg theme-card border">
                <div class="text-3xl mb-2">??</div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Custom Themes</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">Create your own color palette with custom colors</p>
            </div>
            <div class="p-4 rounded-lg theme-card border">
                <div class="text-3xl mb-2">??</div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-1">LocalStorage</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">Your theme choice is saved and persists across sessions</p>
            </div>
            <div class="p-4 rounded-lg theme-card border">
                <div class="text-3xl mb-2">?</div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Instant Apply</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">See changes immediately without page reload</p>
            </div>
            <div class="p-4 rounded-lg theme-card border">
                <div class="text-3xl mb-2">??</div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-1">CSS Variables</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">Uses modern CSS custom properties for theming</p>
            </div>
        </div>
    </div>
</div>

@code {
    private ThemeSettings currentSettings = new();
    private bool _isInitialized = false;

    protected override void OnInitialized()
    {
        // Subscribe to theme changes
        ThemeService.OnThemeChanged += OnThemeChanged;
        
        // Set default settings without JS interop
        currentSettings = new ThemeSettings
        {
            PresetName = "Ocean",
            Mode = "Light",
            Colors = ThemePresets.Ocean.Light
        };
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_isInitialized)
        {
            try
            {
                // Initialize theme service after first render when JS is available
                await ThemeService.InitializeAsync();
                currentSettings = await ThemeService.LoadThemeAsync();
                _isInitialized = true;
                StateHasChanged();
            }
            catch (Exception ex)
            {
                // Handle JS interop errors gracefully
                Console.WriteLine($"Theme initialization error: {ex.Message}");
            }
        }
    }

    private void OnThemeChanged()
    {
        InvokeAsync(async () =>
        {
            try
            {
                currentSettings = await ThemeService.LoadThemeAsync();
                StateHasChanged();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Theme change error: {ex.Message}");
            }
        });
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= OnThemeChanged;
    }
}
