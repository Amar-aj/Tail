@using Tail.Blazor.AccordionItem
@using Tail.Blazor.Divider
@using Tail.Blazor.Layout
@using Tail.Blazor.Navigation
@using Tail.Blazor.Feedback
@using Tail.Blazor.Buttons
@using Tail.Blazor.Menu
@using Tail.Blazor.MenuItem
@using Tail.Blazor.Core.Theme
@using Tail.Blazor.Core.Enums
@using Tail.Blazor.Docs.Shared
@inject NavigationManager Navigation
@implements IDisposable


<TailMenu class="space-y-1">
    <!-- Home -->
    <TailMenuItem Href="/" IsActive="@IsActive("/")">
        <Icon>üè†</Icon>
        <ChildContent>Home</ChildContent>
    </TailMenuItem>

    <!-- Documentation -->
    <TailAccordionItem Title="Documentation" Icon="üìö" IsExpanded="@IsExpanded("/docs")">
        <TailMenu class="pl-4 space-y-1">
            <TailMenuItem Href="/docs" IsActive="@IsActive("/docs")">
                <ChildContent>Overview</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/docs/installation" IsActive="@IsActive("/docs/installation")">
                <ChildContent>Installation</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/getting-started" IsActive="@IsActive("/getting-started")">
                <ChildContent>Quick Start</ChildContent>
            </TailMenuItem>
        </TailMenu>
    </TailAccordionItem>

    <!-- Components by Package -->
    @foreach (var packageGroup in componentPackageGroups)
    {
        <TailAccordionItem Title="@($"{packageGroup.Icon} {packageGroup.Name}")" Icon="@packageGroup.Icon" IsExpanded="@IsExpanded(packageGroup.AllComponentsHref)">
            <TailMenu class="pl-4 space-y-1">
                <TailMenuItem Href="@packageGroup.AllComponentsHref" IsActive="@IsActive(packageGroup.AllComponentsHref)">
                    <ChildContent>All @packageGroup.Name</ChildContent>
                </TailMenuItem>
                <TailDivider class="my-1" />
                <TailContainer Size="Tail.Blazor.Container.ContainerSize.Full" Class="@GetScrollableClass(packageGroup.HasScrollableList)">
                    <TailMenu class="space-y-1">
                        @foreach (var component in packageGroup.Components)
                        {
                            <TailMenuItem Href="@component.Href" IsActive="@IsActive(component.Href)" class="text-xs">
                                <ChildContent>@component.Text</ChildContent>
                            </TailMenuItem>
                        }
                    </TailMenu>
                </TailContainer>
            </TailMenu>
        </TailAccordionItem>
    }

    <!-- Theming -->
    <TailAccordionItem Title="Theming" Icon="üé®" IsExpanded="@IsExpanded("/theming")">
        <TailMenu class="pl-4 space-y-1">
            <TailMenuItem Href="/theming" IsActive="@IsActive("/theming")">
                <ChildContent>Overview</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/theme-toggle-demo" IsActive="@IsActive("/theme-toggle-demo")">
                <ChildContent>Theme Toggle</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/theme-selector-demo" IsActive="@IsActive("/theme-selector-demo")">
                <ChildContent>Theme Selector</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/docs/theme-integration" IsActive="@IsActive("/docs/theme-integration")">
                <ChildContent>Theme Integration</ChildContent>
            </TailMenuItem>
        </TailMenu>
    </TailAccordionItem>

    <!-- Resources -->
    <TailAccordionItem Title="Resources" Icon="üìö" IsExpanded="@IsExpanded("/examples")">
        <TailMenu class="pl-4 space-y-1">
            <TailMenuItem Href="/examples" IsActive="@IsActive("/examples")">
                <Icon>üí°</Icon>
                <ChildContent>Examples</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/best-practices" IsActive="@IsActive("/best-practices")">
                <Icon>‚ú®</Icon>
                <ChildContent>Best Practices</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/faq" IsActive="@IsActive("/faq")">
                <Icon>‚ùì</Icon>
                <ChildContent>FAQ</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/api" IsActive="@IsActive("/api")">
                <Icon>üìö</Icon>
                <ChildContent>API Reference</ChildContent>
            </TailMenuItem>
            <TailMenuItem Href="/scope" IsActive="@IsActive("/scope")">
                <Icon>üìä</Icon>
                <ChildContent>Scope & Status</ChildContent>
            </TailMenuItem>
        </TailMenu>
    </TailAccordionItem>
</TailMenu>


@code {
    private string? _currentPath;

    private class ComponentPackageGroup
    {
        public string Name { get; set; } = string.Empty;
        public string Icon { get; set; } = string.Empty;
        public int ComponentCount { get; set; }
        public string AllComponentsHref { get; set; } = string.Empty;
        public List<NavMenuItem> Components { get; set; } = new();
        public bool HasScrollableList { get; set; }
    }

    private List<ComponentPackageGroup> componentPackageGroups = new();

    protected override void OnInitialized()
    {
        _currentPath = Navigation.Uri;
        Navigation.LocationChanged += OnLocationChanged;

        componentPackageGroups = new List<ComponentPackageGroup>
        {
            new ComponentPackageGroup
            {
                Name = "Buttons",
                Icon = "üîò",
                ComponentCount = 6,
                AllComponentsHref = "/components/buttons",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/button", Text = "Button" },
                    new NavMenuItem { Href = "/components/icon-button", Text = "IconButton" },
                    new NavMenuItem { Href = "/components/toggle-button", Text = "ToggleButton" },
                    new NavMenuItem { Href = "/components/split-button", Text = "SplitButton" },
                    new NavMenuItem { Href = "/components/fab", Text = "FAB" },
                    new NavMenuItem { Href = "/components/button-group", Text = "ButtonGroup" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Forms",
                Icon = "üìù",
                ComponentCount = 26,
                AllComponentsHref = "/components/forms",
                HasScrollableList = true,
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/input", Text = "Input" },
                    new NavMenuItem { Href = "/components/textarea", Text = "Textarea" },
                    new NavMenuItem { Href = "/components/select", Text = "Select" },
                    new NavMenuItem { Href = "/components/checkbox", Text = "Checkbox" },
                    new NavMenuItem { Href = "/components/radio", Text = "Radio" },
                    new NavMenuItem { Href = "/components/radio-group", Text = "RadioGroup" },
                    new NavMenuItem { Href = "/components/switch", Text = "Switch" },
                    new NavMenuItem { Href = "/components/slider", Text = "Slider" },
                    new NavMenuItem { Href = "/components/rating", Text = "Rating" },
                    new NavMenuItem { Href = "/components/date-picker", Text = "DatePicker" },
                    new NavMenuItem { Href = "/components/date-range-picker", Text = "DateRangePicker" },
                    new NavMenuItem { Href = "/components/time-picker", Text = "TimePicker" },
                    new NavMenuItem { Href = "/components/color-picker", Text = "ColorPicker" },
                    new NavMenuItem { Href = "/components/file-upload", Text = "FileUpload" },
                    new NavMenuItem { Href = "/components/image-cropper", Text = "ImageCropper" },
                    new NavMenuItem { Href = "/components/auto-complete", Text = "AutoComplete" },
                    new NavMenuItem { Href = "/components/multi-select", Text = "MultiSelect" },
                    new NavMenuItem { Href = "/components/tag-input", Text = "TagInput" },
                    new NavMenuItem { Href = "/components/mask", Text = "Mask" },
                    new NavMenuItem { Href = "/components/numeric", Text = "Numeric" },
                    new NavMenuItem { Href = "/components/currency-input", Text = "CurrencyInput" },
                    new NavMenuItem { Href = "/components/phone-number-input", Text = "PhoneNumberInput" },
                    new NavMenuItem { Href = "/components/otp-input", Text = "OTPInput" },
                    new NavMenuItem { Href = "/components/password-strength-meter", Text = "PasswordStrengthMeter" },
                    new NavMenuItem { Href = "/components/rich-text-editor", Text = "RichTextEditor" },
                    new NavMenuItem { Href = "/components/audio-recorder", Text = "AudioRecorder" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Layout",
                Icon = "üìê",
                ComponentCount = 12,
                AllComponentsHref = "/components/layout",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/container", Text = "Container" },
                    new NavMenuItem { Href = "/components/grid", Text = "Grid" },
                    new NavMenuItem { Href = "/components/panel", Text = "Panel" },
                    new NavMenuItem { Href = "/components/card", Text = "Card" },
                    new NavMenuItem { Href = "/components/divider", Text = "Divider" },
                    new NavMenuItem { Href = "/components/header", Text = "Header" },
                    new NavMenuItem { Href = "/components/nav-menu", Text = "NavMenu" },
                    new NavMenuItem { Href = "/components/responsive-layout", Text = "ResponsiveLayout" },
                    new NavMenuItem { Href = "/components/split-pane", Text = "SplitPane" },
                    new NavMenuItem { Href = "/components/docking-layout", Text = "DockingLayout" },
                    new NavMenuItem { Href = "/components/bottom-sheet", Text = "BottomSheet" },
                    new NavMenuItem { Href = "/components/collapsible-menu", Text = "CollapsibleMenu" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Navigation",
                Icon = "üß≠",
                ComponentCount = 15,
                AllComponentsHref = "/components/navigation",
                HasScrollableList = true,
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/accordion", Text = "Accordion" },
                    new NavMenuItem { Href = "/components/accordion-item", Text = "AccordionItem" },
                    new NavMenuItem { Href = "/components/tabs", Text = "Tabs" },
                    new NavMenuItem { Href = "/components/breadcrumb", Text = "Breadcrumb" },
                    new NavMenuItem { Href = "/components/menu", Text = "Menu" },
                    new NavMenuItem { Href = "/components/menu-item", Text = "MenuItem" },
                    new NavMenuItem { Href = "/components/sidebar", Text = "Sidebar" },
                    new NavMenuItem { Href = "/components/steps", Text = "Steps" },
                    new NavMenuItem { Href = "/components/pagination", Text = "Pagination" },
                    new NavMenuItem { Href = "/components/carousel", Text = "Carousel" },
                    new NavMenuItem { Href = "/components/mega-menu", Text = "MegaMenu" },
                    new NavMenuItem { Href = "/components/context-menu", Text = "ContextMenu" },
                    new NavMenuItem { Href = "/components/floating-action-menu", Text = "FloatingActionMenu" },
                    new NavMenuItem { Href = "/components/command-palette", Text = "CommandPalette" },
                    new NavMenuItem { Href = "/components/scroll-spy", Text = "ScrollSpy" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Feedback",
                Icon = "üí¨",
                ComponentCount = 14,
                AllComponentsHref = "/components/feedback",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/alert", Text = "Alert" },
                    new NavMenuItem { Href = "/components/badge", Text = "Badge" },
                    new NavMenuItem { Href = "/components/dialog", Text = "Dialog" },
                    new NavMenuItem { Href = "/components/toast", Text = "Toast" },
                    new NavMenuItem { Href = "/components/toast-container", Text = "ToastContainer" },
                    new NavMenuItem { Href = "/components/spinner", Text = "Spinner" },
                    new NavMenuItem { Href = "/components/progress", Text = "Progress" },
                    new NavMenuItem { Href = "/components/progress-bar-circular", Text = "ProgressBarCircular" },
                    new NavMenuItem { Href = "/components/skeleton", Text = "Skeleton" },
                    new NavMenuItem { Href = "/components/empty-state", Text = "EmptyState" },
                    new NavMenuItem { Href = "/components/popconfirm", Text = "Popconfirm" },
                    new NavMenuItem { Href = "/components/confetti", Text = "Confetti" },
                    new NavMenuItem { Href = "/components/notification-center", Text = "NotificationCenter" },
                    new NavMenuItem { Href = "/components/tour", Text = "Tour" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Data",
                Icon = "üìä",
                ComponentCount = 10,
                AllComponentsHref = "/components/data",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/data-grid", Text = "DataGrid" },
                    new NavMenuItem { Href = "/components/list-view", Text = "ListView" },
                    new NavMenuItem { Href = "/components/tree", Text = "Tree" },
                    new NavMenuItem { Href = "/components/scheduler", Text = "Scheduler" },
                    new NavMenuItem { Href = "/components/pager", Text = "Pager" },
                    new NavMenuItem { Href = "/components/virtual-scroll", Text = "VirtualScroll" },
                    new NavMenuItem { Href = "/components/advanced-filter", Text = "AdvancedFilter" },
                    new NavMenuItem { Href = "/components/kanban-board", Text = "KanbanBoard" },
                    new NavMenuItem { Href = "/components/pivot-data-grid", Text = "PivotDataGrid" },
                    new NavMenuItem { Href = "/components/responsive-table", Text = "ResponsiveTable" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Charts",
                Icon = "üìà",
                ComponentCount = 2,
                AllComponentsHref = "/components/charts",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/chart", Text = "Chart" },
                    new NavMenuItem { Href = "/components/sparkline", Text = "Sparkline" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Visualization",
                Icon = "üé®",
                ComponentCount = 6,
                AllComponentsHref = "/components/visualization",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/timeline", Text = "Timeline" },
                    new NavMenuItem { Href = "/components/arc-gauge", Text = "ArcGauge" },
                    new NavMenuItem { Href = "/components/flowchart", Text = "Flowchart" },
                    new NavMenuItem { Href = "/components/gantt-chart", Text = "GanttChart" },
                    new NavMenuItem { Href = "/components/organization-chart", Text = "OrganizationChart" },
                    new NavMenuItem { Href = "/components/qr-code", Text = "QRCode" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Validators",
                Icon = "‚úÖ",
                ComponentCount = 7,
                AllComponentsHref = "/components/validators",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/validator", Text = "Validator" },
                    new NavMenuItem { Href = "/components/required-validator", Text = "RequiredValidator" },
                    new NavMenuItem { Href = "/components/email-validator", Text = "EmailValidator" },
                    new NavMenuItem { Href = "/components/length-validator", Text = "LengthValidator" },
                    new NavMenuItem { Href = "/components/range-validator", Text = "RangeValidator" },
                    new NavMenuItem { Href = "/components/numeric-range-validator", Text = "NumericRangeValidator" },
                    new NavMenuItem { Href = "/components/regex-validator", Text = "RegexValidator" },
                    new NavMenuItem { Href = "/components/compare-validator", Text = "CompareValidator" },
                    new NavMenuItem { Href = "/components/custom-validator", Text = "CustomValidator" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Utils",
                Icon = "üõ†Ô∏è",
                ComponentCount = 2,
                AllComponentsHref = "/components/utils",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/clipboard", Text = "Clipboard" },
                    new NavMenuItem { Href = "/components/image-zoom", Text = "ImageZoom" }
                }
            },
            new ComponentPackageGroup
            {
                Name = "Icons",
                Icon = "üéØ",
                ComponentCount = 1,
                AllComponentsHref = "/components/icons",
                Components = new List<NavMenuItem>
                {
                    new NavMenuItem { Href = "/components/icon", Text = "Icon" }
                }
            }
        };
    }

    private void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        _currentPath = e.Location;
        InvokeAsync(StateHasChanged);
    }

    private bool IsActive(string href)
    {
        if (string.IsNullOrEmpty(_currentPath) || string.IsNullOrEmpty(href))
            return false;

        var currentPath = _currentPath.Split('?')[0].ToLowerInvariant();
        var targetPath = href.ToLowerInvariant();

        // Exact match
        if (currentPath == targetPath)
            return true;

        // Check if current path starts with target path (for sub-routes)
        if (targetPath != "/" && currentPath.StartsWith(targetPath))
            return true;

        return false;
    }

    private bool IsExpanded(string href)
    {
        if (string.IsNullOrEmpty(_currentPath) || string.IsNullOrEmpty(href))
            return false;

        var currentPath = _currentPath.Split('?')[0].ToLowerInvariant();
        var targetPath = href.ToLowerInvariant();

        // Check if current path starts with target path (for sub-routes)
        return targetPath != "/" && currentPath.StartsWith(targetPath);
    }

    private string GetScrollableClass(bool hasScrollableList)
    {
        return hasScrollableList ? "max-h-64 overflow-y-auto" : "";
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}
