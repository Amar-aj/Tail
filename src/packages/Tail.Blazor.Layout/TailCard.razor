@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Layout

<div class="@GetCardClasses()" style="@GetCardStyle()" @attributes="AdditionalAttributes">
    @if (!string.IsNullOrEmpty(Header))
    {
        <div class="px-6 py-4" style="@GetHeaderStyle()">
            <h3 class="text-lg font-semibold" style="color: var(--color-text-primary)">@Header</h3>
        </div>
    }
    @if (HeaderContent != null)
    {
        <div class="px-6 py-4" style="@GetHeaderStyle()">
            @HeaderContent
        </div>
    }
    <div class="@GetBodyClasses()">
        @ChildContent
    </div>
    @if (!string.IsNullOrEmpty(Footer))
    {
        <div class="px-6 py-4" style="@GetFooterStyle()">
            @Footer
        </div>
    }
    @if (FooterContent != null)
    {
        <div class="px-6 py-4" style="@GetFooterStyle()">
            @FooterContent
        </div>
    }
</div>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? HeaderContent { get; set; }
    [Parameter] public RenderFragment? FooterContent { get; set; }
    [Parameter] public string? Header { get; set; }
    [Parameter] public string? Footer { get; set; }
    [Parameter] public CardElevation Elevation { get; set; } = CardElevation.Medium;
    [Parameter] public bool Rounded { get; set; } = true;
    [Parameter] public bool Bordered { get; set; } = true;
    [Parameter] public bool Hoverable { get; set; } = false;
    [Parameter] public CardSurface SurfaceLevel { get; set; } = CardSurface.Default;
    [Parameter] public string? BodyClass { get; set; }

    private string GetCardClasses()
    {
        var classes = new List<string> { "overflow-hidden" };
        
        if (Hoverable)
        {
            classes.Add("cursor-pointer");
        }
        
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private string GetCardStyle()
    {
        var styles = new List<string>();
        
        // Surface level
        styles.Add(SurfaceLevel switch
        {
            CardSurface.Default => "background-color: var(--color-surface)",
            CardSurface.Elevated => "background-color: var(--color-surface-2)",
            CardSurface.Raised => "background-color: var(--color-surface-3)",
            _ => "background-color: var(--color-surface)"
        });
        
        // Border
        if (Bordered)
        {
            styles.Add("border: 1px solid var(--color-border)");
        }
        
        // Shadow based on elevation
        var shadow = Elevation switch
        {
            CardElevation.None => "none",
            CardElevation.Small => "var(--shadow-sm)",
            CardElevation.Medium => "var(--shadow-md)",
            CardElevation.Large => "var(--shadow-lg)",
            _ => "var(--shadow-md)"
        };
        styles.Add($"box-shadow: {shadow}");
        
        // Border radius
        if (Rounded)
        {
            styles.Add("border-radius: var(--radius-lg)");
        }
        
        // Transitions
        styles.Add("transition: box-shadow var(--transition-normal), transform var(--transition-normal)");
        
        // Hover effects
        if (Hoverable)
        {
            var hoverShadow = Elevation switch
            {
                CardElevation.None => "var(--shadow-sm)",
                CardElevation.Small => "var(--shadow-md)",
                CardElevation.Medium => "var(--shadow-lg)",
                CardElevation.Large => "var(--shadow-lg)",
                _ => "var(--shadow-lg)"
            };
        }
        
        return string.Join("; ", styles);
    }

    private string GetHeaderStyle()
    {
        return "border-bottom: 1px solid var(--color-divider);";
    }

    private string GetFooterStyle()
    {
        return @"
            border-top: 1px solid var(--color-divider);
            background-color: color-mix(in srgb, var(--color-border) 20%, var(--color-surface));
        ";
    }

    private string GetBodyClasses()
    {
        var classes = new List<string> { "px-6 py-4" };
        
        if (!string.IsNullOrEmpty(BodyClass))
        {
            classes.Add(BodyClass);
        }
        
        return string.Join(" ", classes);
    }

    public enum CardElevation
    {
        None,
        Small,
        Medium,
        Large
    }

    public enum CardSurface
    {
        Default,
        Elevated,
        Raised
    }
}


