@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Layout

<div class="@GetLayoutClasses()" style="@GetLayoutStyle()">
    <!-- Header -->
    <TailHeader 
        AppName="@AppName"
        LogoTemplate="@LogoTemplate"
        CenterContent="@HeaderCenterContent"
        ActionsTemplate="@HeaderActionsTemplate"
        UserMenuItems="@UserMenuItems"
        ShowMenuToggle="@ShowMenuToggle"
        ShowThemeToggle="@ShowThemeToggle"
        ShowAvatar="@ShowAvatar"
        Sticky="@StickyHeader"
        Transparent="@TransparentHeader"
        Shadow="@HeaderShadow"
        UserName="@UserName"
        UserEmail="@UserEmail"
        AvatarUrl="@AvatarUrl"
        OnMenuToggle="HandleMenuToggle"
        IsMenuOpen="@isMenuOpen" />
    
    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar/Menu -->
        @if (ShowSidebar)
        {
            <TailCollapsibleMenu 
                IsOpen="@isMenuOpen"
                IsOpenChanged="HandleMenuOpenChanged"
                MobileMenuTitle="@MobileMenuTitle"
                Position="@MenuPosition">
                @SidebarContent
            </TailCollapsibleMenu>
        }
        
        <!-- Main Content -->
        <main class="@GetMainClasses()" style="@GetMainStyle()">
            @ChildContent
        </main>
    </div>
</div>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? SidebarContent { get; set; }
    [Parameter] public RenderFragment? LogoTemplate { get; set; }
    [Parameter] public RenderFragment? HeaderCenterContent { get; set; }
    [Parameter] public RenderFragment? HeaderActionsTemplate { get; set; }
    [Parameter] public RenderFragment? UserMenuItems { get; set; }
    
    [Parameter] public string? AppName { get; set; }
    [Parameter] public string? UserName { get; set; }
    [Parameter] public string? UserEmail { get; set; }
    [Parameter] public string? AvatarUrl { get; set; }
    [Parameter] public string? MobileMenuTitle { get; set; }
    
    [Parameter] public bool ShowMenuToggle { get; set; } = true;
    [Parameter] public bool ShowThemeToggle { get; set; } = true;
    [Parameter] public bool ShowAvatar { get; set; } = true;
    [Parameter] public bool ShowSidebar { get; set; } = true;
    [Parameter] public bool StickyHeader { get; set; } = true;
    [Parameter] public bool TransparentHeader { get; set; } = false;
    [Parameter] public bool HeaderShadow { get; set; } = true;
    
    [Parameter] public TailCollapsibleMenu.MenuPosition MenuPosition { get; set; } = TailCollapsibleMenu.MenuPosition.Left;
    
    private bool isMenuOpen;

    private Task HandleMenuToggle(bool isOpen)
    {
        isMenuOpen = isOpen;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private Task HandleMenuOpenChanged(bool isOpen)
    {
        isMenuOpen = isOpen;
        StateHasChanged();
        return Task.CompletedTask;
    }

    private string GetLayoutClasses()
    {
        var classes = new List<string> { "min-h-screen flex flex-col" };
        
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private string GetLayoutStyle()
    {
        return "background-color: var(--color-background);";
    }

    private string GetMainClasses()
    {
        return "flex-1 overflow-auto";
    }

    private string GetMainStyle()
    {
        return @"
            background-color: var(--color-background);
            transition: background-color var(--transition-normal);
        ";
    }
}
