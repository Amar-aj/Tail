@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Feedback

<div class="@GetContainerClasses()" @attributes="AdditionalAttributes">
    <svg class="@GetSvgClasses()" viewBox="0 0 36 36">
        <path class="text-gray-200 dark:text-gray-700"
              d="M18 2.0845
                a 15.9155 15.9155 0 0 1 0 31.831
                a 15.9155 15.9155 0 0 1 0 -31.831"
              fill="none"
              stroke="currentColor"
              stroke-width="2"/>
        <path class="@GetPathClasses()"
              stroke-dasharray="@GetDashArray(), 100"
              d="M18 2.0845
                a 15.9155 15.9155 0 0 1 0 31.831
                a 15.9155 15.9155 0 0 1 0 -31.831"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"/>
    </svg>
    @if (ShowLabel)
    {
        <div class="@GetLabelClasses()">
            <span class="text-sm font-semibold">@Value%</span>
        </div>
    }
</div>

@code {
    [Parameter] public int Value { get; set; } = 0;
    [Parameter] public ProgressVariant Variant { get; set; } = ProgressVariant.Primary;
    [Parameter] public int Size { get; set; } = 100;
    [Parameter] public bool ShowLabel { get; set; } = true;
    [Parameter] public bool Animated { get; set; } = true;

    private string GetContainerClasses()
    {
        var classes = new List<string> { "relative inline-flex items-center justify-center" };
        
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private string GetSvgClasses()
    {
        var classes = new List<string> { "transform -rotate-90" };
        
        if (Animated)
        {
            classes.Add("transition-all duration-300");
        }
        
        return string.Join(" ", classes);
    }

    private string GetPathClasses()
    {
        var classes = new List<string>();
        
        classes.Add(Variant switch
        {
            ProgressVariant.Primary => "text-blue-600",
            ProgressVariant.Success => "text-green-600",
            ProgressVariant.Warning => "text-yellow-600",
            ProgressVariant.Danger => "text-red-600",
            ProgressVariant.Info => "text-cyan-600",
            _ => "text-blue-600"
        });
        
        return string.Join(" ", classes);
    }

    private string GetLabelClasses()
    {
        return "absolute inset-0 flex items-center justify-center";
    }

    private double GetDashArray()
    {
        var circumference = 2 * Math.PI * 15.9155;
        return (Value / 100.0) * circumference;
    }
}

