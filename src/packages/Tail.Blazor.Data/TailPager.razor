@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Data

<nav class="@GetPagerClasses()" aria-label="Pagination" @attributes="AdditionalAttributes">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
            <button
                type="button"
                class="@GetButtonClasses(true)"
                @onclick="GoToFirstPage"
                disabled="@(CurrentPage == 1)"
                aria-label="First page">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                </svg>
            </button>
            <button
                type="button"
                class="@GetButtonClasses(true)"
                @onclick="GoToPreviousPage"
                disabled="@(CurrentPage == 1)"
                aria-label="Previous page">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
        </div>
        
        <div class="flex items-center space-x-1">
            @foreach (var page in GetVisiblePages())
            {
                @if (page == -1)
                {
                    <span class="px-4 py-2 text-gray-500">...</span>
                }
                else
                {
                    <button
                        type="button"
                        class="@GetPageButtonClasses(page)"
                        @onclick="() => GoToPage(page)"
                        aria-label="Page @page"
                        aria-current="@(page == CurrentPage ? "page" : null)">
                        @page
                    </button>
                }
            }
        </div>
        
        <div class="flex items-center space-x-2">
            <button
                type="button"
                class="@GetButtonClasses(false)"
                @onclick="GoToNextPage"
                disabled="@(CurrentPage >= TotalPages)"
                aria-label="Next page">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
            <button
                type="button"
                class="@GetButtonClasses(false)"
                @onclick="GoToLastPage"
                disabled="@(CurrentPage >= TotalPages)"
                aria-label="Last page">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                </svg>
            </button>
        </div>
    </div>
    
    @if (ShowInfo)
    {
        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400 text-center">
            Showing @((CurrentPage - 1) * PageSize + 1) to @(Math.Min(CurrentPage * PageSize, TotalItems)) of @TotalItems
        </div>
    }
</nav>

@code {
    [Parameter] public int CurrentPage { get; set; } = 1;
    [Parameter] public EventCallback<int> CurrentPageChanged { get; set; }
    [Parameter] public int TotalPages { get; set; } = 1;
    [Parameter] public int TotalItems { get; set; } = 0;
    [Parameter] public int PageSize { get; set; } = 10;
    [Parameter] public bool ShowInfo { get; set; } = false;
    [Parameter] public int MaxVisiblePages { get; set; } = 5;

    private string GetPagerClasses()
    {
        var classes = new List<string> { "w-full" };
        
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private string GetButtonClasses(bool isPrevious)
    {
        return "px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg " +
               "hover:bg-gray-50 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed " +
               "dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700";
    }

    private string GetPageButtonClasses(int page)
    {
        var classes = new List<string> 
        { 
            "px-4 py-2 text-sm font-medium rounded-lg transition-colors",
            "focus:outline-none focus:ring-2 focus:ring-blue-500"
        };
        
        if (page == CurrentPage)
        {
            classes.Add("bg-blue-600 text-white");
        }
        else
        {
            classes.Add("text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 " +
                       "dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700");
        }
        
        return string.Join(" ", classes);
    }

    private List<int> GetVisiblePages()
    {
        var pages = new List<int>();
        
        if (TotalPages <= MaxVisiblePages)
        {
            for (int i = 1; i <= TotalPages; i++)
            {
                pages.Add(i);
            }
        }
        else
        {
            if (CurrentPage <= 3)
            {
                for (int i = 1; i <= 4; i++) pages.Add(i);
                pages.Add(-1); // Ellipsis
                pages.Add(TotalPages);
            }
            else if (CurrentPage >= TotalPages - 2)
            {
                pages.Add(1);
                pages.Add(-1); // Ellipsis
                for (int i = TotalPages - 3; i <= TotalPages; i++) pages.Add(i);
            }
            else
            {
                pages.Add(1);
                pages.Add(-1); // Ellipsis
                for (int i = CurrentPage - 1; i <= CurrentPage + 1; i++) pages.Add(i);
                pages.Add(-1); // Ellipsis
                pages.Add(TotalPages);
            }
        }
        
        return pages;
    }

    private async Task GoToPage(int page)
    {
        if (page >= 1 && page <= TotalPages && page != CurrentPage)
        {
            CurrentPage = page;
            if (CurrentPageChanged.HasDelegate)
            {
                await CurrentPageChanged.InvokeAsync(CurrentPage);
            }
        }
    }

    private async Task GoToFirstPage()
    {
        await GoToPage(1);
    }

    private async Task GoToPreviousPage()
    {
        await GoToPage(CurrentPage - 1);
    }

    private async Task GoToNextPage()
    {
        await GoToPage(CurrentPage + 1);
    }

    private async Task GoToLastPage()
    {
        await GoToPage(TotalPages);
    }
}

