@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Charts

<svg class="@GetSparklineClasses()" viewBox="0 0 @Width @Height" @attributes="AdditionalAttributes">
    <polyline
        points="@GetPoints()"
        fill="none"
        stroke="@Color"
        stroke-width="@StrokeWidth"
        class="transition-all duration-300" />
    @if (ShowArea)
    {
        <polygon
            points="@GetAreaPoints()"
            fill="@Color"
            opacity="0.2"
            class="transition-all duration-300" />
    }
</svg>

@code {
    [Parameter] public List<double> Values { get; set; } = new();
    [Parameter] public int Width { get; set; } = 100;
    [Parameter] public int Height { get; set; } = 30;
    [Parameter] public string Color { get; set; } = "#3b82f6";
    [Parameter] public int StrokeWidth { get; set; } = 2;
    [Parameter] public bool ShowArea { get; set; } = false;

    private string GetSparklineClasses()
    {
        var classes = new List<string> { "w-full h-full" };
        
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private string GetPoints()
    {
        if (Values == null || Values.Count == 0) return "";
        
        var points = new List<string>();
        var maxValue = Values.Max();
        var minValue = Values.Min();
        var range = maxValue - minValue;
        if (range == 0) range = 1;
        
        var stepX = (double)Width / (Values.Count - 1);
        
        for (int i = 0; i < Values.Count; i++)
        {
            var x = i * stepX;
            var normalizedValue = (Values[i] - minValue) / range;
            var y = Height - (normalizedValue * Height);
            points.Add($"{x},{y}");
        }
        
        return string.Join(" ", points);
    }

    private string GetAreaPoints()
    {
        var points = GetPoints();
        if (string.IsNullOrEmpty(points)) return "";
        
        var pointList = points.Split(' ');
        var firstPoint = pointList[0].Split(',');
        var lastPoint = pointList[^1].Split(',');
        
        return $"{points} {lastPoint[0]},{Height} {firstPoint[0]},{Height}";
    }
}

