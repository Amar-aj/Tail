@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Forms

<label class="@GetLabelClasses()" @attributes="AdditionalAttributes">
    <input 
        type="checkbox"
        class="sr-only peer"
        checked="@IsChecked"
        @onchange="HandleChange"
        disabled="@Disabled" />
    <div class="@GetSwitchClasses()">
        <div class="@GetThumbClasses()"></div>
    </div>
    @if (!string.IsNullOrEmpty(Label))
    {
        <span class="@GetTextClasses()">
            @Label
        </span>
    }
    else
    {
        <span class="@GetTextClasses()">
            @ChildContent
        </span>
    }
</label>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public string? Label { get; set; }
    [Parameter] public bool IsChecked { get; set; }
    [Parameter] public EventCallback<bool> IsCheckedChanged { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public SwitchSize Size { get; set; } = SwitchSize.Md;
    [Parameter] public SwitchVariant Variant { get; set; } = SwitchVariant.Primary;

    private string GetLabelClasses()
    {
        var classes = new List<string> { "relative inline-flex items-center cursor-pointer" };
        
        if (Disabled)
        {
            classes.Add("opacity-50 cursor-not-allowed");
        }
        
        return string.Join(" ", classes);
    }

    private string GetSwitchClasses()
    {
        var classes = new List<string> 
        { 
            "relative inline-flex shrink-0 cursor-pointer rounded-full border-2 border-transparent",
            "transition-colors duration-200 ease-in-out",
            "peer-checked:bg-blue-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 peer-focus:ring-offset-2",
            "peer-disabled:cursor-not-allowed peer-disabled:opacity-50"
        };
        
        classes.Add(Size switch
        {
            SwitchSize.Sm => "h-4 w-7",
            SwitchSize.Md => "h-6 w-11",
            SwitchSize.Lg => "h-7 w-14",
            _ => "h-6 w-11"
        });
        
        classes.Add(Variant switch
        {
            SwitchVariant.Primary => "peer-checked:bg-blue-600 peer-focus:ring-blue-500",
            SwitchVariant.Success => "peer-checked:bg-green-600 peer-focus:ring-green-500",
            SwitchVariant.Warning => "peer-checked:bg-yellow-600 peer-focus:ring-yellow-500",
            SwitchVariant.Danger => "peer-checked:bg-red-600 peer-focus:ring-red-500",
            _ => "peer-checked:bg-blue-600"
        });
        
        classes.Add("bg-gray-200 dark:bg-gray-700");
        
        return string.Join(" ", classes);
    }

    private string GetThumbClasses()
    {
        var classes = new List<string> 
        { 
            "pointer-events-none inline-block rounded-full bg-white shadow transform ring-0 transition duration-200 ease-in-out",
            "peer-checked:translate-x-5"
        };
        
        classes.Add(Size switch
        {
            SwitchSize.Sm => "h-3 w-3 translate-x-0",
            SwitchSize.Md => "h-5 w-5 translate-x-0",
            SwitchSize.Lg => "h-6 w-6 translate-x-0",
            _ => "h-5 w-5 translate-x-0"
        });
        
        classes.Add(Size switch
        {
            SwitchSize.Sm => "peer-checked:translate-x-3",
            SwitchSize.Md => "peer-checked:translate-x-5",
            SwitchSize.Lg => "peer-checked:translate-x-7",
            _ => "peer-checked:translate-x-5"
        });
        
        return string.Join(" ", classes);
    }

    private string GetTextClasses()
    {
        var classes = new List<string> { "ml-3 text-sm text-gray-700 dark:text-gray-300" };
        
        classes.Add(Size switch
        {
            SwitchSize.Sm => "text-xs",
            SwitchSize.Md => "text-sm",
            SwitchSize.Lg => "text-base",
            _ => "text-sm"
        });
        
        return string.Join(" ", classes);
    }

    private async Task HandleChange(ChangeEventArgs e)
    {
        if (bool.TryParse(e.Value?.ToString(), out var newValue))
        {
            IsChecked = newValue;
            if (IsCheckedChanged.HasDelegate)
            {
                await IsCheckedChanged.InvokeAsync(IsChecked);
            }
        }
    }
}


