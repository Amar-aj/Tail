@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Forms

<div class="@GetWrapperClasses()" @attributes="AdditionalAttributes">
    @if (!string.IsNullOrEmpty(Label))
    {
        <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">@Label</label>
            @if (ShowValue)
            {
                <span class="text-sm text-gray-500 dark:text-gray-400">@CurrentValue</span>
            }
        </div>
    }
    <input 
        type="range"
        class="@GetSliderClasses()"
        value="@CurrentValue"
        @oninput="HandleInput"
        min="@Min"
        max="@Max"
        step="@Step"
        disabled="@Disabled" />
    @if (ShowTicks)
    {
        <div class="flex justify-between mt-1 text-xs text-gray-500 dark:text-gray-400">
            <span>@Min</span>
            <span>@Max</span>
        </div>
    }
</div>

@code {
    [Parameter] public double Value { get; set; }
    [Parameter] public EventCallback<double> ValueChanged { get; set; }
    [Parameter] public string? Label { get; set; }
    [Parameter] public double Min { get; set; } = 0;
    [Parameter] public double Max { get; set; } = 100;
    [Parameter] public double Step { get; set; } = 1;
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool ShowValue { get; set; } = true;
    [Parameter] public bool ShowTicks { get; set; } = false;
    [Parameter] public SliderVariant Variant { get; set; } = SliderVariant.Primary;
    [Parameter] public SliderSize Size { get; set; } = SliderSize.Md;

    private double CurrentValue => Value;

    private string GetWrapperClasses()
    {
        var classes = new List<string> { "w-full" };
        
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private string GetSliderClasses()
    {
        var classes = new List<string> 
        { 
            "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",
            "disabled:opacity-50 disabled:cursor-not-allowed"
        };
        
        classes.Add(Size switch
        {
            SliderSize.Sm => "h-1",
            SliderSize.Md => "h-2",
            SliderSize.Lg => "h-3",
            _ => "h-2"
        });
        
        classes.Add(Variant switch
        {
            SliderVariant.Primary => "accent-blue-600",
            SliderVariant.Success => "accent-green-600",
            SliderVariant.Warning => "accent-yellow-600",
            SliderVariant.Danger => "accent-red-600",
            _ => "accent-blue-600"
        });
        
        classes.Add("dark:bg-gray-700");
        
        return string.Join(" ", classes);
    }

    private async Task HandleInput(ChangeEventArgs e)
    {
        if (double.TryParse(e.Value?.ToString(), out var newValue))
        {
            Value = newValue;
            if (ValueChanged.HasDelegate)
            {
                await ValueChanged.InvokeAsync(Value);
            }
        }
    }
}


