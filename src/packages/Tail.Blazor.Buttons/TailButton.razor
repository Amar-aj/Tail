@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Buttons

<button 
    type="@Type"
    class="@GetButtonClasses()"
    disabled="@Disabled"
    @onclick="@HandleClick"
    @onclick:preventDefault="@PreventDefault"
    @onclick:stopPropagation="@StopPropagation"
    @attributes="AdditionalAttributes">
    @if (Loading)
    {
        <svg class="@GetLoadingIconClasses()" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        @if (!string.IsNullOrEmpty(LoadingText))
        {
            <span>@LoadingText</span>
        }
        else if (ChildContent != null)
        {
            @ChildContent
        }
    }
    else
    {
        @* Image or Icon at start *@
        @if (ImageStartContent != null)
        {
            <span class="@GetImageStartClasses()">
                @ImageStartContent
            </span>
        }
        else if (!string.IsNullOrEmpty(ImageStart))
        {
            <img src="@ImageStart" alt="" class="@GetImageStartClasses()" />
        }
        else if (IconStartContent != null)
        {
            <span class="@GetIconStartClasses()">
                @IconStartContent
            </span>
        }
        else if (!string.IsNullOrEmpty(IconStart))
        {
            <span class="@GetIconStartClasses()">
                @((MarkupString)IconStart)
            </span>
        }
        @* Button text/content *@
        @if (ChildContent != null)
        {
            @ChildContent
        }
        @* Image or Icon at end *@
        @if (ImageEndContent != null)
        {
            <span class="@GetImageEndClasses()">
                @ImageEndContent
            </span>
        }
        else if (!string.IsNullOrEmpty(ImageEnd))
        {
            <img src="@ImageEnd" alt="" class="@GetImageEndClasses()" />
        }
        else if (IconEndContent != null)
        {
            <span class="@GetIconEndClasses()">
                @IconEndContent
            </span>
        }
        else if (!string.IsNullOrEmpty(IconEnd))
        {
            <span class="@GetIconEndClasses()">
                @((MarkupString)IconEnd)
            </span>
        }
    }
</button>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public ButtonVariant Variant { get; set; } = ButtonVariant.Primary;
    [Parameter] public ButtonSize Size { get; set; } = ButtonSize.Md;
    [Parameter] public string? OutlineColor { get; set; } // For Outline variant: "primary", "success", "warning", "danger", "info"
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool Loading { get; set; }
    [Parameter] public string? LoadingText { get; set; }
    [Parameter] public string? IconStart { get; set; }
    [Parameter] public RenderFragment? IconStartContent { get; set; }
    [Parameter] public string? IconEnd { get; set; }
    [Parameter] public RenderFragment? IconEndContent { get; set; }
    [Parameter] public string? ImageStart { get; set; }
    [Parameter] public RenderFragment? ImageStartContent { get; set; }
    [Parameter] public string? ImageEnd { get; set; }
    [Parameter] public RenderFragment? ImageEndContent { get; set; }
    [Parameter] public string Type { get; set; } = "button";
    [Parameter] public bool PreventDefault { get; set; } = false;
    [Parameter] public bool StopPropagation { get; set; } = false;
    [Parameter] public bool FullWidth { get; set; } = false;
    [Parameter] public bool Rounded { get; set; } = true;
    [Parameter] public EventCallback<MouseEventArgs> OnClick { get; set; }

    private string GetButtonClasses()
    {
        var classes = new List<string> 
        { 
            "font-medium inline-flex items-center justify-center",
            "focus:outline-none focus:ring-2 focus:ring-offset-2",
            "transition-all duration-200 ease-in-out",
            "disabled:opacity-50 disabled:cursor-not-allowed disabled:pointer-events-none"
        };
        
        // Rounded corners
        if (Rounded)
        {
            classes.Add(Size switch
            {
                ButtonSize.Xs => "rounded",
                ButtonSize.Sm => "rounded",
                ButtonSize.Md => "rounded-md",
                ButtonSize.Lg => "rounded-lg",
                ButtonSize.Xl => "rounded-lg",
                _ => "rounded-md"
            });
        }
        else
        {
            classes.Add("rounded-none");
        }
        
        // Full width
        if (FullWidth)
        {
            classes.Add("w-full");
        }
        
        // Size classes
        classes.Add(GetSizeClasses());
        
        // Variant classes
        classes.Add(GetVariantClasses());
        
        // Custom classes
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private string GetSizeClasses()
    {
        return Size switch
        {
            ButtonSize.Xs => "px-2 py-1 text-xs",
            ButtonSize.Sm => "px-3 py-1.5 text-sm",
            ButtonSize.Md => "px-4 py-2 text-base",
            ButtonSize.Lg => "px-5 py-2.5 text-lg",
            ButtonSize.Xl => "px-6 py-3 text-xl",
            _ => "px-4 py-2 text-base"
        };
    }

    private string GetVariantClasses()
    {
        if (Disabled || Loading)
        {
            return string.Empty;
        }

        return Variant switch
        {
            ButtonVariant.Primary => "bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 shadow-sm hover:shadow-md focus:ring-blue-500 dark:bg-blue-500 dark:hover:bg-blue-600",
            ButtonVariant.Success => "bg-green-600 text-white hover:bg-green-700 active:bg-green-800 shadow-sm hover:shadow-md focus:ring-green-500 dark:bg-green-500 dark:hover:bg-green-600",
            ButtonVariant.Warning => "bg-yellow-500 text-white hover:bg-yellow-600 active:bg-yellow-700 shadow-sm hover:shadow-md focus:ring-yellow-500 dark:bg-yellow-400 dark:hover:bg-yellow-500",
            ButtonVariant.Danger => "bg-red-600 text-white hover:bg-red-700 active:bg-red-800 shadow-sm hover:shadow-md focus:ring-red-500 dark:bg-red-500 dark:hover:bg-red-600",
            ButtonVariant.Info => "bg-cyan-600 text-white hover:bg-cyan-700 active:bg-cyan-800 shadow-sm hover:shadow-md focus:ring-cyan-500 dark:bg-cyan-500 dark:hover:bg-cyan-600",
            ButtonVariant.Outline => GetOutlineVariantClasses(),
            ButtonVariant.Soft => GetSoftVariantClasses(),
            ButtonVariant.Ghost => "bg-transparent text-blue-600 hover:bg-blue-50 active:bg-blue-100 focus:ring-blue-500 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:active:bg-blue-900/30",
            ButtonVariant.Link => "bg-transparent text-blue-600 hover:text-blue-700 hover:underline p-0 focus:ring-blue-500 dark:text-blue-400 dark:hover:text-blue-300",
            _ => "bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500"
        };
    }

    private string GetOutlineVariantClasses()
    {
        var color = OutlineColor?.ToLower() ?? "primary";
        
        return color switch
        {
            "primary" or "blue" => "bg-transparent border-2 border-blue-600 text-blue-600 hover:bg-blue-50 hover:border-blue-700 active:bg-blue-100 focus:ring-blue-500 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:border-blue-300",
            "success" or "green" => "bg-transparent border-2 border-green-600 text-green-600 hover:bg-green-50 hover:border-green-700 active:bg-green-100 focus:ring-green-500 dark:border-green-400 dark:text-green-400 dark:hover:bg-green-900/20 dark:hover:border-green-300",
            "warning" or "yellow" => "bg-transparent border-2 border-yellow-500 text-yellow-600 hover:bg-yellow-50 hover:border-yellow-600 active:bg-yellow-100 focus:ring-yellow-500 dark:border-yellow-400 dark:text-yellow-400 dark:hover:bg-yellow-900/20 dark:hover:border-yellow-300",
            "danger" or "red" => "bg-transparent border-2 border-red-600 text-red-600 hover:bg-red-50 hover:border-red-700 active:bg-red-100 focus:ring-red-500 dark:border-red-400 dark:text-red-400 dark:hover:bg-red-900/20 dark:hover:border-red-300",
            "info" or "cyan" => "bg-transparent border-2 border-cyan-600 text-cyan-600 hover:bg-cyan-50 hover:border-cyan-700 active:bg-cyan-100 focus:ring-cyan-500 dark:border-cyan-400 dark:text-cyan-400 dark:hover:bg-cyan-900/20 dark:hover:border-cyan-300",
            _ => "bg-transparent border-2 border-blue-600 text-blue-600 hover:bg-blue-50 hover:border-blue-700 active:bg-blue-100 focus:ring-blue-500 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/20"
        };
    }

    private string GetSoftVariantClasses()
    {
        return Variant switch
        {
            ButtonVariant.Soft => "bg-blue-50 text-blue-700 hover:bg-blue-100 active:bg-blue-200 focus:ring-blue-500 dark:bg-blue-900/30 dark:text-blue-300 dark:hover:bg-blue-900/40 dark:active:bg-blue-900/50",
            _ => "bg-blue-50 text-blue-700 hover:bg-blue-100 focus:ring-blue-500"
        };
    }

    private string GetLoadingIconClasses()
    {
        var spacing = Size switch
        {
            ButtonSize.Xs => "mr-1.5 h-3 w-3",
            ButtonSize.Sm => "mr-2 h-3.5 w-3.5",
            ButtonSize.Md => "mr-2 h-4 w-4",
            ButtonSize.Lg => "mr-2.5 h-5 w-5",
            ButtonSize.Xl => "mr-3 h-6 w-6",
            _ => "mr-2 h-4 w-4"
        };
        return $"animate-spin {spacing}";
    }

    private string GetIconStartClasses()
    {
        var spacing = Size switch
        {
            ButtonSize.Xs => "mr-1.5",
            ButtonSize.Sm => "mr-2",
            ButtonSize.Md => "mr-2",
            ButtonSize.Lg => "mr-2.5",
            ButtonSize.Xl => "mr-3",
            _ => "mr-2"
        };
        var iconSize = Size switch
        {
            ButtonSize.Xs => "h-3 w-3",
            ButtonSize.Sm => "h-3.5 w-3.5",
            ButtonSize.Md => "h-4 w-4",
            ButtonSize.Lg => "h-5 w-5",
            ButtonSize.Xl => "h-6 w-6",
            _ => "h-4 w-4"
        };
        return $"{spacing} {iconSize} flex-shrink-0";
    }

    private string GetIconEndClasses()
    {
        var spacing = Size switch
        {
            ButtonSize.Xs => "ml-1.5",
            ButtonSize.Sm => "ml-2",
            ButtonSize.Md => "ml-2",
            ButtonSize.Lg => "ml-2.5",
            ButtonSize.Xl => "ml-3",
            _ => "ml-2"
        };
        var iconSize = Size switch
        {
            ButtonSize.Xs => "h-3 w-3",
            ButtonSize.Sm => "h-3.5 w-3.5",
            ButtonSize.Md => "h-4 w-4",
            ButtonSize.Lg => "h-5 w-5",
            ButtonSize.Xl => "h-6 w-6",
            _ => "h-4 w-4"
        };
        return $"{spacing} {iconSize} flex-shrink-0";
    }

    private string GetImageStartClasses()
    {
        var spacing = Size switch
        {
            ButtonSize.Xs => "mr-1.5",
            ButtonSize.Sm => "mr-2",
            ButtonSize.Md => "mr-2",
            ButtonSize.Lg => "mr-2.5",
            ButtonSize.Xl => "mr-3",
            _ => "mr-2"
        };
        var imageSize = Size switch
        {
            ButtonSize.Xs => "h-4 w-4",
            ButtonSize.Sm => "h-5 w-5",
            ButtonSize.Md => "h-6 w-6",
            ButtonSize.Lg => "h-7 w-7",
            ButtonSize.Xl => "h-8 w-8",
            _ => "h-6 w-6"
        };
        return $"{spacing} {imageSize} flex-shrink-0 object-cover rounded";
    }

    private string GetImageEndClasses()
    {
        var spacing = Size switch
        {
            ButtonSize.Xs => "ml-1.5",
            ButtonSize.Sm => "ml-2",
            ButtonSize.Md => "ml-2",
            ButtonSize.Lg => "ml-2.5",
            ButtonSize.Xl => "ml-3",
            _ => "ml-2"
        };
        var imageSize = Size switch
        {
            ButtonSize.Xs => "h-4 w-4",
            ButtonSize.Sm => "h-5 w-5",
            ButtonSize.Md => "h-6 w-6",
            ButtonSize.Lg => "h-7 w-7",
            ButtonSize.Xl => "h-8 w-8",
            _ => "h-6 w-6"
        };
        return $"{spacing} {imageSize} flex-shrink-0 object-cover rounded";
    }

    private async Task HandleClick(MouseEventArgs e)
    {
        if (!Disabled && !Loading && OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync(e);
        }
    }
}
