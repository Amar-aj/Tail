@inherits Tail.Blazor.Core.TailComponentBase
@namespace Tail.Blazor.Visualization

<div class="@GetQRCodeClasses()" @attributes="AdditionalAttributes">
    <svg width="@Size" height="@Size" viewBox="0 0 @(Size) @(Size)">
        @RenderQRCode()
    </svg>
</div>

@code {
    [Parameter] public string Value { get; set; } = "";
    [Parameter] public int Size { get; set; } = 200;
    [Parameter] public string ForegroundColor { get; set; } = "#000000";
    [Parameter] public string BackgroundColor { get; set; } = "#FFFFFF";
    [Parameter] public int ErrorCorrectionLevel { get; set; } = 1; // 1-4

    private string GetQRCodeClasses()
    {
        var classes = new List<string> { "inline-block" };
        
        if (!string.IsNullOrEmpty(CssClass))
        {
            classes.Add(CssClass);
        }
        
        return string.Join(" ", classes);
    }

    private RenderFragment RenderQRCode()
    {
        // Simplified QR code rendering
        // In production, use a QR code library or generate proper QR pattern
        return builder =>
        {
            builder.OpenElement(0, "rect");
            builder.AddAttribute(1, "width", Size);
            builder.AddAttribute(2, "height", Size);
            builder.AddAttribute(3, "fill", BackgroundColor);
            builder.CloseElement();
            
            // Placeholder pattern - would be replaced with actual QR code generation
            builder.OpenElement(4, "text");
            builder.AddAttribute(5, "x", Size / 2);
            builder.AddAttribute(6, "y", Size / 2);
            builder.AddAttribute(7, "text-anchor", "middle");
            builder.AddAttribute(8, "fill", ForegroundColor);
            builder.AddAttribute(9, "font-size", "12");
            builder.AddContent(10, Value.Length > 20 ? Value.Substring(0, 20) + "..." : Value);
            builder.CloseElement();
        };
    }
}

