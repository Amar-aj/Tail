@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.Dialog

@if (IsVisible)
{
    <div class="fixed inset-0 z-50 overflow-y-auto" @onclick="HandleBackdropClick">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-black opacity-50 transition-opacity" style="background-color: rgba(0, 0, 0, 0.5);"></div>
            <div 
                class="@GetDialogClasses()"
                @onclick:stopPropagation="true"
                style="@GetDialogStyles()"
                role="dialog"
                aria-modal="true">
                @if (!string.IsNullOrEmpty(Title))
                {
                    <div class="flex items-center justify-between mb-4 pb-4 border-b" style="border-color: var(--color-border, #e5e7eb);">
                        <h3 class="text-lg font-semibold" style="color: var(--color-text-primary);">@Title</h3>
                        @if (ShowCloseButton)
                        {
                            <button 
                                type="button"
                                class="text-gray-400 hover:text-gray-600 focus:outline-none"
                                @onclick="HandleClose"
                                aria-label="Close">
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        }
                    </div>
                }
                <div class="@GetContentClasses()" style="color: var(--color-text-primary);">
                    @ChildContent
                </div>
                @if (Footer != null)
                {
                    <div class="mt-4 pt-4 border-t flex justify-end gap-2" style="border-color: var(--color-border, #e5e7eb);">
                        @Footer
                    </div>
                }
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public EventCallback<bool> IsVisibleChanged { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? Footer { get; set; }
    [Parameter] public string? Title { get; set; }
    [Parameter] public DialogSize Size { get; set; } = DialogSize.Md;
    [Parameter] public bool ShowCloseButton { get; set; } = true;
    [Parameter] public bool CloseOnBackdropClick { get; set; } = true;
    [Parameter] public string? Style { get; set; }

    private string GetDialogClasses()
    {
        var classes = new List<string> { "relative", "bg-white", "rounded-lg", "shadow-xl", "transform", "transition-all" };

        classes.Add(Size switch
        {
            DialogSize.Sm => "max-w-sm",
            DialogSize.Md => "max-w-md",
            DialogSize.Lg => "max-w-lg",
            DialogSize.Xl => "max-w-xl",
            DialogSize.Xxl => "max-w-2xl",
            DialogSize.Full => "max-w-full mx-4",
            _ => "max-w-md"
        });

        return string.Join(" ", classes);
    }

    private string GetDialogStyles()
    {
        var styles = new List<string>();
        styles.Add($"background-color: var(--color-surface, white)");
        styles.Add($"color: var(--color-text-primary, black)");
        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }
        return string.Join("; ", styles);
    }

    private string GetContentClasses()
    {
        var classes = new List<string> { "w-full" };
        return string.Join(" ", classes);
    }

    private async Task HandleClose()
    {
        IsVisible = false;
        await IsVisibleChanged.InvokeAsync(false);
    }

    private async Task HandleBackdropClick()
    {
        if (CloseOnBackdropClick)
        {
            await HandleClose();
        }
    }
}

