@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.Steps

<div class="@GetStepsClasses()">
    @for (int i = 0; i < Steps.Count; i++)
    {
        var step = Steps[i];
        var stepNumber = i + 1;
        var isActive = stepNumber == CurrentStep;
        var isCompleted = stepNumber < CurrentStep;

        <div class="flex items-center">
            <div class="@GetStepCircleClasses(isActive, isCompleted)" style="@GetStepCircleStyles(isActive, isCompleted)">
                @if (isCompleted)
                {
                    <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                }
                else
                {
                    <span>@stepNumber</span>
                }
            </div>
            <div class="ml-3">
                <div class="font-medium" style="color: var(--color-text-primary);">@step.Title</div>
                @if (!string.IsNullOrEmpty(step.Description))
                {
                    <div class="text-sm" style="color: var(--color-text-secondary);">@step.Description</div>
                }
            </div>
            @if (i < Steps.Count - 1)
            {
                <div class="@GetConnectorClasses(isCompleted)" style="@GetConnectorStyles(isCompleted)"></div>
            }
        </div>
    }
</div>

@code {
    [Parameter] public List<StepItem> Steps { get; set; } = new();
    [Parameter] public int CurrentStep { get; set; } = 1;
    [Parameter] public string? Style { get; set; }

    private string GetStepsClasses()
    {
        var classes = new List<string> { "flex", "flex-col", "space-y-4" };
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetStepCircleClasses(bool isActive, bool isCompleted)
    {
        var classes = new List<string> { "flex", "items-center", "justify-center", "w-10", "h-10", "rounded-full", "font-semibold", "border-2" };

        if (isActive)
        {
            classes.Add("border-primary bg-primary text-white");
        }
        else if (isCompleted)
        {
            classes.Add("border-primary bg-primary text-white");
        }
        else
        {
            classes.Add("border-gray-300 bg-white text-gray-500");
        }

        return string.Join(" ", classes);
    }

    private string GetStepCircleStyles(bool isActive, bool isCompleted)
    {
        var styles = new List<string>();

        if (isActive || isCompleted)
        {
            styles.Add($"border-color: var(--color-primary)");
            styles.Add($"background-color: var(--color-primary)");
            styles.Add($"color: var(--color-text-on-primary, white)");
        }
        else
        {
            styles.Add($"border-color: var(--color-border, #d1d5db)");
            styles.Add($"background-color: var(--color-surface, white)");
            styles.Add($"color: var(--color-text-secondary, #6b7280)");
        }

        return string.Join("; ", styles);
    }

    private string GetConnectorClasses(bool isCompleted)
    {
        var classes = new List<string> { "w-full", "h-0.5", "ml-5", "mb-5" };
        return string.Join(" ", classes);
    }

    private string GetConnectorStyles(bool isCompleted)
    {
        var styles = new List<string>();

        if (isCompleted)
        {
            styles.Add($"background-color: var(--color-primary)");
        }
        else
        {
            styles.Add($"background-color: var(--color-border, #d1d5db)");
        }

        return string.Join("; ", styles);
    }
}

@code {
    public class StepItem
    {
        public string Title { get; set; } = string.Empty;
        public string? Description { get; set; }
    }
}

