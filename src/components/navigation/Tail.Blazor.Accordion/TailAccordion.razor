@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.Accordion

<div class="@GetAccordionClasses()">
    @foreach (var item in Items)
    {
        <div class="border-b" style="border-color: var(--color-border, #e5e7eb);">
            <button
                type="button"
                class="@GetHeaderClasses(item)"
                @onclick="() => ToggleItem(item)"
                style="@GetHeaderStyles()">
                <span>@item.Title</span>
                <svg 
                    class="w-5 h-5 transition-transform @(item.IsExpanded ? "transform rotate-180" : "")"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            @if (item.IsExpanded)
            {
                <div class="p-4" style="color: var(--color-text-primary);">
                    @item.Content
                </div>
            }
        </div>
    }
</div>

@code {
    [Parameter] public List<AccordionItem> Items { get; set; } = new();
    [Parameter] public bool AllowMultiple { get; set; }
    [Parameter] public string? Style { get; set; }

    private string GetAccordionClasses()
    {
        var classes = new List<string> { "w-full", "border", "rounded-lg", "overflow-hidden" };
        classes.Add("border-gray-200");
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetHeaderClasses(AccordionItem item)
    {
        var classes = new List<string> { "w-full", "flex", "items-center", "justify-between", "p-4", "text-left", "hover:bg-gray-50", "transition-colors" };
        return string.Join(" ", classes);
    }

    private string GetHeaderStyles()
    {
        var styles = new List<string>();
        styles.Add($"background-color: var(--color-surface, white)");
        styles.Add($"color: var(--color-text-primary, black)");
        return string.Join("; ", styles);
    }

    private void ToggleItem(AccordionItem item)
    {
        if (!AllowMultiple)
        {
            foreach (var otherItem in Items)
            {
                if (otherItem != item)
                {
                    otherItem.IsExpanded = false;
                }
            }
        }
        item.IsExpanded = !item.IsExpanded;
    }
}

@code {
    public class AccordionItem
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Title { get; set; } = string.Empty;
        public RenderFragment? Content { get; set; }
        public bool IsExpanded { get; set; }
    }
}

