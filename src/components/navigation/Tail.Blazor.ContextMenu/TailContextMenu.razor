@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.ContextMenu

<div class="relative" @oncontextmenu="HandleContextMenu" @oncontextmenu:preventDefault="true">
    @ChildContent
    @if (IsVisible)
    {
        <div class="@GetMenuClasses()" style="@GetMenuStyles()">
            @foreach (var item in Items)
            {
                <button
                    type="button"
                    class="@GetMenuItemClasses()"
                    @onclick="() => HandleItemClick(item)">
                    @item.Label
                </button>
            }
        </div>
    }
</div>

@code {
    private bool IsVisible { get; set; }

    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public List<ContextMenuItem> Items { get; set; } = new();
    [Parameter] public EventCallback<ContextMenuItem> OnItemClick { get; set; }
    [Parameter] public string? Style { get; set; }

    private string GetMenuClasses()
    {
        var classes = new List<string> { "absolute", "z-50", "bg-white", "rounded-lg", "shadow-lg", "border", "py-1", "min-w-48" };
        return string.Join(" ", classes);
    }

    private string GetMenuStyles()
    {
        var styles = new List<string>();
        styles.Add($"background-color: var(--color-surface, white)");
        styles.Add($"border-color: var(--color-border, #e5e7eb)");
        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }
        return string.Join("; ", styles);
    }

    private string GetMenuItemClasses()
    {
        return "w-full text-left px-4 py-2 hover:bg-gray-100 transition-colors";
    }

    private void HandleContextMenu(MouseEventArgs e)
    {
        IsVisible = true;
    }

    private async Task HandleItemClick(ContextMenuItem item)
    {
        IsVisible = false;
        await OnItemClick.InvokeAsync(item);
    }
}

@code {
    public class ContextMenuItem
    {
        public string Label { get; set; } = string.Empty;
        public EventCallback OnClick { get; set; }
    }
}

