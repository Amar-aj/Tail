@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.Flowchart

<div class="@GetFlowchartClasses()" style="@GetFlowchartStyles()">
    <svg width="@Width" height="@Height">
        @foreach (var node in Nodes)
        {
            <rect
                x="@node.X"
                y="@node.Y"
                width="100"
                height="50"
                rx="5"
                fill="var(--color-primary)"
                style="fill: var(--color-primary);" />
            @((MarkupString)$"<text x=\"{node.X + 50}\" y=\"{node.Y + 30}\" text-anchor=\"middle\" fill=\"white\" font-size=\"14\">{node.Label}</text>")
        }
        @foreach (var connection in Connections)
        {
            <line
                x1="@connection.FromX"
                y1="@connection.FromY"
                x2="@connection.ToX"
                y2="@connection.ToY"
                stroke="var(--color-border, #e5e7eb)"
                stroke-width="2"
                marker-end="url(#arrowhead)" />
        }
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                <polygon points="0 0, 10 3, 0 6" fill="var(--color-border, #e5e7eb)" />
            </marker>
        </defs>
    </svg>
</div>

@code {
    [Parameter] public List<FlowchartNode> Nodes { get; set; } = new();
    [Parameter] public List<FlowchartConnection> Connections { get; set; } = new();
    [Parameter] public int Width { get; set; } = 800;
    [Parameter] public int Height { get; set; } = 600;
    [Parameter] public string? Style { get; set; }

    private string GetFlowchartClasses()
    {
        var classes = new List<string> { "inline-block" };
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetFlowchartStyles()
    {
        var styles = new List<string>();
        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }
        return string.Join("; ", styles);
    }
}

@code {
    public class FlowchartNode
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Label { get; set; } = string.Empty;
        public double X { get; set; }
        public double Y { get; set; }
    }

    public class FlowchartConnection
    {
        public string FromId { get; set; } = string.Empty;
        public string ToId { get; set; } = string.Empty;
        public double FromX { get; set; }
        public double FromY { get; set; }
        public double ToX { get; set; }
        public double ToY { get; set; }
    }
}

