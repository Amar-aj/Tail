@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.GanttChart

<div class="@GetGanttClasses()" style="@GetGanttStyles()">
    <div class="grid grid-cols-12 gap-1">
        @foreach (var task in Tasks)
        {
            <div class="col-span-@(GetTaskSpan(task)) p-2 bg-primary rounded text-white text-xs" style="background-color: var(--color-primary);">
                @task.Name
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public List<GanttTask> Tasks { get; set; } = new();
    [Parameter] public DateTime StartDate { get; set; } = DateTime.Now;
    [Parameter] public DateTime EndDate { get; set; } = DateTime.Now.AddDays(30);
    [Parameter] public string? Style { get; set; }

    private int GetTaskSpan(GanttTask task)
    {
        var totalDays = (EndDate - StartDate).Days;
        var taskDays = (task.EndDate - task.StartDate).Days;
        return Math.Max(1, (int)((taskDays / (double)totalDays) * 12));
    }

    private string GetGanttClasses()
    {
        var classes = new List<string> { "w-full", "p-4" };
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetGanttStyles()
    {
        var styles = new List<string>();
        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }
        return string.Join("; ", styles);
    }
}

@code {
    public class GanttTask
    {
        public string Name { get; set; } = string.Empty;
        public DateTime StartDate { get; set; }
        public DateTime EndDate { get; set; }
    }
}

