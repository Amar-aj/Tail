@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.ArcGauge

<div class="@GetGaugeClasses()" style="@GetGaugeStyles()">
    <svg width="@Size" height="@(Size / 2)" class="overflow-visible">
        <path
            d="@GetArcPath()"
            fill="none"
            stroke="var(--color-surface-secondary, #e5e7eb)"
            stroke-width="@StrokeWidth" />
        <path
            d="@GetValueArcPath()"
            fill="none"
            stroke="var(--color-primary)"
            stroke-width="@StrokeWidth"
            stroke-linecap="round" />
        @if (ShowLabel)
        {
            @((MarkupString)$"<text x=\"{Size / 2}\" y=\"{Size / 2 - 10}\" text-anchor=\"middle\" font-size=\"24\" font-weight=\"bold\" fill=\"var(--color-text-primary, black)\">{Value}%</text>")
        }
    </svg>
</div>

@code {
    [Parameter] public int Value { get; set; }
    [Parameter] public int Size { get; set; } = 200;
    [Parameter] public int StrokeWidth { get; set; } = 20;
    [Parameter] public bool ShowLabel { get; set; } = true;
    [Parameter] public string? Style { get; set; }

    private double Radius => (Size - StrokeWidth) / 2;
    private double CenterX => Size / 2;
    private double CenterY => Size / 2;

    private string GetGaugeClasses()
    {
        var classes = new List<string> { "inline-block" };
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetGaugeStyles()
    {
        var styles = new List<string>();
        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }
        return string.Join("; ", styles);
    }

    private string GetArcPath()
    {
        var startAngle = 180;
        var endAngle = 0;
        var startRad = startAngle * Math.PI / 180;
        var endRad = endAngle * Math.PI / 180;
        var x1 = CenterX + Radius * Math.Cos(startRad);
        var y1 = CenterY + Radius * Math.Sin(startRad);
        var x2 = CenterX + Radius * Math.Cos(endRad);
        var y2 = CenterY + Radius * Math.Sin(endRad);
        var largeArc = 0;
        return $"M {x1} {y1} A {Radius} {Radius} 0 {largeArc} 0 {x2} {y2}";
    }

    private string GetValueArcPath()
    {
        var startAngle = 180;
        var endAngle = 180 - (Value / 100.0) * 180;
        var startRad = startAngle * Math.PI / 180;
        var endRad = endAngle * Math.PI / 180;
        var x1 = CenterX + Radius * Math.Cos(startRad);
        var y1 = CenterY + Radius * Math.Sin(startRad);
        var x2 = CenterX + Radius * Math.Cos(endRad);
        var y2 = CenterY + Radius * Math.Sin(endRad);
        var largeArc = Value > 50 ? 1 : 0;
        return $"M {x1} {y1} A {Radius} {Radius} 0 {largeArc} 0 {x2} {y2}";
    }
}

