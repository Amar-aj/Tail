@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.VirtualScroll
@typeparam T

<div class="@GetContainerClasses()" style="@GetContainerStyles()" @onscroll="HandleScroll">
    <div style="height: @(TotalHeight)px; position: relative;">
        <div style="transform: translateY(@(OffsetY)px);">
            @foreach (var item in VisibleItems)
            {
                <div style="height: @(ItemHeight)px;">
                    @ItemTemplate(item)
                </div>
            }
        </div>
    </div>
</div>

@code {
    [Parameter] public List<T> Items { get; set; } = new();
    [Parameter] public RenderFragment<T> ItemTemplate { get; set; } = default!;
    [Parameter] public int ItemHeight { get; set; } = 50;
    [Parameter] public int VisibleCount { get; set; } = 10;
    [Parameter] public string? Style { get; set; }

    private double ScrollTop { get; set; }
    private int StartIndex => Math.Max(0, (int)(ScrollTop / ItemHeight) - 2);
    private int EndIndex => Math.Min(Items.Count, StartIndex + VisibleCount + 4);
    private List<T> VisibleItems => Items.Skip(StartIndex).Take(EndIndex - StartIndex).ToList();
    private double TotalHeight => Items.Count * ItemHeight;
    private double OffsetY => StartIndex * ItemHeight;

    private string GetContainerClasses()
    {
        var classes = new List<string> { "overflow-y-auto" };
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetContainerStyles()
    {
        var styles = new List<string>();
        styles.Add($"max-height: {VisibleCount * ItemHeight}px");
        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }
        return string.Join("; ", styles);
    }

    private void HandleScroll(EventArgs e)
    {
        // Scroll position would be tracked via JS interop in full implementation
    }
}

