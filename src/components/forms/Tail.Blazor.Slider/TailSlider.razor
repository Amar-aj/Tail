@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.Slider

<div class="@GetWrapperClasses()">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="block text-sm font-medium mb-1" for="@SliderId">
            @Label
            @if (ShowValue)
            {
                <span class="ml-2 text-primary font-semibold">@Value</span>
            }
        </label>
    }
    <input 
        id="@SliderId"
        type="range"
        min="@Min"
        max="@Max"
        step="@Step"
        value="@Value"
        @oninput="HandleInput"
        class="@GetSliderClasses()"
        disabled="@Disabled"
        @attributes="AdditionalAttributes"
        style="@GetSliderStyles()" />
    @if (ShowLabels)
    {
        <div class="flex justify-between text-xs text-gray-500 mt-1">
            <span>@Min</span>
            <span>@Max</span>
        </div>
    }
    @if (!string.IsNullOrEmpty(HelpText))
    {
        <div class="text-sm text-gray-500 mt-1">
            @HelpText
        </div>
    }
</div>

@code {
    private string SliderId { get; set; } = Guid.NewGuid().ToString();

    [Parameter] public double Value { get; set; }
    [Parameter] public EventCallback<double> ValueChanged { get; set; }
    [Parameter] public double Min { get; set; } = 0;
    [Parameter] public double Max { get; set; } = 100;
    [Parameter] public double Step { get; set; } = 1;
    [Parameter] public SliderSize Size { get; set; } = SliderSize.Md;
    [Parameter] public SliderVariant Variant { get; set; } = SliderVariant.Primary;
    [Parameter] public string? Label { get; set; }
    [Parameter] public string? HelpText { get; set; }
    [Parameter] public bool ShowValue { get; set; }
    [Parameter] public bool ShowLabels { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public string? Style { get; set; }

    private string GetWrapperClasses()
    {
        var classes = new List<string> { "w-full" };
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetSliderClasses()
    {
        var classes = new List<string> { "w-full", "h-2", "rounded-lg", "appearance-none", "cursor-pointer", "transition-colors" };

        // Size classes
        classes.Add(Size switch
        {
            SliderSize.Sm => "h-1",
            SliderSize.Md => "h-2",
            SliderSize.Lg => "h-3",
            _ => "h-2"
        });

        if (Disabled)
        {
            classes.Add("opacity-50 cursor-not-allowed");
        }

        return string.Join(" ", classes);
    }

    private string GetSliderStyles()
    {
        var styles = new List<string>();

        // Use CSS variables for theming
        styles.Add($"background: linear-gradient(to right, var(--color-primary) 0%, var(--color-primary) {((Value - Min) / (Max - Min)) * 100}%, var(--color-border, #d1d5db) {((Value - Min) / (Max - Min)) * 100}%, var(--color-border, #d1d5db) 100%)");

        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }

        return string.Join("; ", styles);
    }

    private async Task HandleInput(ChangeEventArgs e)
    {
        if (double.TryParse(e.Value?.ToString(), out var newValue))
        {
            Value = newValue;
            await ValueChanged.InvokeAsync(Value);
        }
    }
}

