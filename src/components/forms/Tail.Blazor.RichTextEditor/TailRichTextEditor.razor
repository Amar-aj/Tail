@inherits TailComponentBase
@using Microsoft.AspNetCore.Components.Web
@using Tail.Blazor.RichTextEditor

<div class="@GetWrapperClasses()">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="block text-sm font-medium mb-1">
            @Label
        </label>
    }
    <div class="border border-gray-300 rounded-lg overflow-hidden" style="border-color: var(--color-border, #d1d5db);">
        <div class="flex items-center gap-1 p-2 border-b border-gray-200 bg-gray-50" style="background-color: var(--color-surface-secondary, #f9fafb); border-color: var(--color-border, #d1d5db);">
            <button type="button" class="p-2 hover:bg-gray-200 rounded" @onclick="() => ExecuteCommand('bold')" title="Bold">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z" />
                </svg>
            </button>
            <button type="button" class="p-2 hover:bg-gray-200 rounded" @onclick="() => ExecuteCommand('italic')" title="Italic">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                </svg>
            </button>
            <button type="button" class="p-2 hover:bg-gray-200 rounded" @onclick="() => ExecuteCommand('underline')" title="Underline">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z" />
                </svg>
            </button>
        </div>
        <div 
            contenteditable="true"
            class="@GetEditorClasses()"
            @ref="editorRef"
            @oninput="HandleInput"
            style="@GetEditorStyles()">
            @((MarkupString)Value)
        </div>
    </div>
</div>

@code {
    private ElementReference editorRef;

    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string?> ValueChanged { get; set; }
    [Parameter] public RichTextEditorSize Size { get; set; } = RichTextEditorSize.Md;
    [Parameter] public string? Label { get; set; }
    [Parameter] public int MinHeight { get; set; } = 200;
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public string? Style { get; set; }

    private string GetWrapperClasses()
    {
        var classes = new List<string> { "w-full" };
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        return string.Join(" ", classes);
    }

    private string GetEditorClasses()
    {
        var classes = new List<string> { "w-full", "p-4", "outline-none", "overflow-auto" };

        classes.Add(Size switch
        {
            RichTextEditorSize.Xs => "text-xs",
            RichTextEditorSize.Sm => "text-sm",
            RichTextEditorSize.Md => "text-base",
            RichTextEditorSize.Lg => "text-lg",
            RichTextEditorSize.Xl => "text-xl",
            _ => "text-base"
        });

        if (Disabled)
        {
            classes.Add("opacity-50 cursor-not-allowed bg-gray-50");
        }

        return string.Join(" ", classes);
    }

    private string GetEditorStyles()
    {
        var styles = new List<string>();
        styles.Add($"min-height: {MinHeight}px");
        styles.Add($"background-color: var(--color-surface, white)");
        styles.Add($"color: var(--color-text-primary, black)");
        if (!string.IsNullOrEmpty(Style))
        {
            styles.Add(Style);
        }
        return string.Join("; ", styles);
    }

    private async Task HandleInput(ChangeEventArgs e)
    {
        // Get content from contenteditable div would require JS interop
        // For now, just trigger the event
        await ValueChanged.InvokeAsync(Value);
    }

    private void ExecuteCommand(string command)
    {
        // Execute formatting command would require JS interop
    }
}

